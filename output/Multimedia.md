## Программы для работы со звуком в Linux

**Базовая система коммутации звуковых потоков:**

  - [Jack Audio Connection Kit](http://jackaudio.org) - необходимый
    элемент системы для соединения разных звуковых устройств,
    музыкальных инструментов, микрофонов, программ для обработки
    звука.
  - [QjackCtl](http://qjackctl.sourceforge.net) - графический интерфейс
    для JACK на Qt4
  - [Patchage](http://drobilla.net/software/patchage) - удобный
    графический инструмент для коммутации звуковых потоков и
    устройств, в частности MIDI.
  - [KXStudio:
    Cadence](http://kxstudio.sourceforge.net/Applications:Cadence) -
    набор приложений для коммутации аудиопотоков и устройств,
    управления Jack-сервером, замера уровня сигнала...
  - [KXStudio:
    Carla](http://kxstudio.sourceforge.net/Applications:Carla) - хост
    аудиоплагинов, поддерживает LADSPA (включая LRDF), DSSI, LV2,
    VST2/3 и AU форматы плагинов,также поддерживаются файлы GIG, SF2 и
    SFZ. Работает с Jack и ALSA.

**Программы для звукозаписи и обработки звука:**

  - [Audacity](http://audacity.sourceforge.net) - достаточно простой, но
    удобный инструмент для записи и обработки звука.
  - [Ardour](http://ardour.org) - профессиональный инструмент для
    многоканальной, многодорожечной записи звука, поддерживает
    несколько разных источников.
  - [Qtractor](http://qtractor.sourceforge.net/qtractor-index.html) -
    многодорожечный аудио/MIDI секвенсор.

**Гитарные процессоры:**

  - [Rakarrack](http://rakarrack.sourceforge.net) - набор гитарных
    эффектов реального времени, комбиков, кабинетов, усилителей,
    множество предустановленных вариантов и возможность "накрутить"
    собственные
  - [Guitarix](http://guitarix.sourceforge.net) - ещё один набор
    гитарных эффектов реального времени, комбиков, кабинетов,
    усилителей, множество предустановленных вариантов и возможность
    "накрутить" собственные.

**Синтезаторы:**

  - [Amsynth](https://code.google.com/p/amsynth) — набор синтезаторов с
    множеством настроек и предустановок. Ввод нот осуществляется с
    MIDI-клавиатуры, которую удобно подключить при помощи
    [Patchage](http://drobilla.net/software/patchage)
  - [LMMS](https://lmms.io) — мультимедийная студия с синтезаторами,
    секвенсорами, кольцами и эффектами.
  - [ZynAddSubFX](http://zynaddsubfx.sourceforge.net/) — набор
    синтезаторов: реального времени, полифонический,
    мультитембральный, микротональный. Также набор эффектов
    для обработки звука. Работает с Jack, поддерживает MIDI, в том
    числе и подключение MIDI-контроллеров.
  - [Yoshimi](http://yoshimi.sourceforge.net/) — форк
    [ZynAddSubFX](http://zynaddsubfx.sourceforge.net/) с
    усовершенствованиями в направлении работы с Jack и
    MIDI.
  - [Dexed](https://github.com/asb2m10/dexed/) — продвинутый эмулятор
    Yamaha DX7. Есть как VST, так и LV2-версия.
  - [Hexter](http://dssi.sourceforge.net/hexter.html) — эмулятор Yamaha
    DX7, существует в виде DSSI-плагина.

**Инструменты для создания трекерной музыки:**

  - [MilkyTracker](http://www.milkytracker.org/) - инструмент для
    создания трекерной музыки.
  - [Schism Tracker](http://schismtracker.org/wiki/Schism%20Tracker) -
    инструмент для создания трекерной музыки, основанный на
    модифицированной версии Modplug -
    [OpenMPT](http://openmpt.org/).

**Драм-машины:**

  - [Hydrogen](http://www.hydrogen-music.org/hcms) - удобная графическая
    драм-машина.
  - [DrumGizmo](http://www.drumgizmo.org/wiki/) - драм-машина в виде
    самостоятельно приложения, также и в виде плагина.

**Наборы эффектов для обработки звука:**

  - [Linux Audio Developer's Simple Plugin API
    (LADSPA)](http://www.ladspa.org) - классический набор эффектов и
    алгоритмов для обработки звука, также язык для разработи
    музыкальных программ.
  - [LV2](http://lv2plug.in) - следующее поколение LADSPA
  - [Calf studio gear](http://calf.sourceforge.net) - набор эффектов и
    алгоримов для обработки звука.

**Нотные редакторы:**

  - [TuxGuitar](https://sourceforge.net/projects/tuxguitar) -
    графический нотный MIDI-редактор, есть возможность
    вбивать ноты на "гитарном грифе" и "пианино".
  - [LilyPond](http://lilypond.org) - крайне минималистичный, но очень
    мощный текстовый "нотный компилятор", часть проекта
    [GNU](http://www.gnu.org).
  - [Frescobaldi](http://www.frescobaldi.org) - продвинутый графический
    интерфейс для LilyPond, удобен возможность работы с мышью
  - [Denemo](http://denemo.org) - ещё один продвинутый графический
    интерфейс для LilyPond
  - [Rosegarden](http://www.rosegardenmusic.com) - графический нотный
    редактор и MIDI-секвенсор.
  - [FluidSynth](http://www.fluidsynth.org) - MIDI-синтезатор реального
    времени без графического интерфейса, работающий по спецификациям
    SoundFont 2.
  - [Qsynth](http://qsynth.sourceforge.net/qsynth-index.html) -
    графический интерфейс для
    [FluidSynth](http://www.fluidsynth.org).
  - [MidiEditor](http://midieditor.sourceforge.net) - простой
    MIDI-редактор.
  - [Musescore](http://musescore.org) - нотный MIDI-редактор с
    графическим интерфейсом.
  - [MusE](http://www.muse-sequencer.org) - MIDI-секвенсор.

**Для начала ссылка на некоторые ресурсы (присылайте ссылки и мы их
включим):**

[Подробная документация по
Mplayer](http://www.mplayerhq.hu/DOCS/HTML/ru/)

[Неофициальный FAQ по MPlayer](http://silinio.webhost.ru/mpfaq.html)

[Хорошо написано о многих опциях кодеков xvid и lavc в
mencoder'е](http://aquatique.rusunix.org/mencoding.html)

[FAQ из которого, в частности, можно узнать, как заставить работать DVD
Shrink через
wine](http://forum.doom9.org/showthread.php?s=&threadid=91894)

## Программы для работы с фотографиями в Linux

**Color management:**

  - [colord](http://www.freedesktop.org/software/colord/) — создание,
    установка и использование по назначению цветовых профилей. GNOME
    Color Manager и colord-kde — графические приложения для работы с
    colord в GNOME и KDE, соответственно
  - [ArgyllCMS](http://www.argyllcms.com/) — CMS, необходимая для
    профилирования вашего фотоаппарата, монитора, сканера и
    принтера

**Обработка, конвертация и управление коллекцией RAW-изображений:**

  - [Darktable](http://www.darktable.org/) — наиболее динамично
    развивающийся, многофункциональный конвертер/каталогизатор
  - [RawTherapee](http://rawtherapee.com/) — другой отличный конвертер и
    каталогизатор в одном лице
  - [Rawstudio](http://rawstudio.org/) — ещё один
  - [UFRaw](http://ufraw.sourceforge.net/) — минималистичный
    RAW-процессор, для предпочитающих обрабатывать фотографии
    уже в графическом редакторе
  - [digiKam](https://www.digikam.org/) — внезапно, тоже имеет базовый
    функционал RAW-конвертации
  - А если вы настолько просветлённый фотограф, что обрабатываете свои
    фотографии сидя в консоли, для вас есть
    [dcraw](https://www.cybercom.net/~dcoffin/dcraw/), код которого
    используется в куче коммерческих и некоммерческих конвертеров

**Графические редакторы:**

  - [GIMP](http://www.gimp.org/) — просто без комментариев
  - [Krita](https://krita.org/) — больше подойдёт художнику, чем
    фотографу. Тем не менее, есть поканальные кривые, Lab, CMYK,
    маски, корректирующие слои и другие, греющие душу, возможности
  - Для просветлённых фотографов из предыдущего раздела подойдёт
    консольный пакет [ImageMagick](http://www.imagemagick.org/)
    — на пару с dcraw позволит завалить мир шедеврами не загружая иксы

**Управление фотоаппаратом с компьютера:**

  - [gPhoto2](http://gphoto.sourceforge.net/) — библиотека, которая
    поддерживает 1800 камер, возможно и вашу
  - [Entangle](http://entangle-photo.org/) — позволяет управлять всеми
    настройками камеры и снимать непосредственно с компьютера

**Focus stacking, склейка панорам и снимков с большим динамическим
диапазоном (HDR):**

  - [Hugin](http://hugin.sourceforge.net/) — мощный инструмент для
    склейки панорам из нескольких снимков
  - [krpano](http://krpano.com/) — создаёт интерактивные виртуальные
    туры в формате HTML5 и Flash-приложений (Проприетарен)
  - [Kolor Autopano
    Giga](http://www.kolor.com/image-stitching-software-autopano-giga.html)
    — мультиплатформенный коммерческий пакет, предназначенный для
    склейки панорам и создания на их основе виртуальных туров
  - [Luminance HDR](http://qtpfsgui.sourceforge.net/) — генерирует
    HDR-фоторафию из нескольких, различно экспонированных, снимков
  - [MacroFusion](http://sourceforge.net/projects/macrofusion/) —
    простая графическая надстройка над Enfuse, позволяющая, в том
    числе склеивать снимки, сделанные с брекетингом по фокусу, для
    получения большей ГРИП, например при макросъёмке

**Time-lapse:**

  - [Kdenlive](https://kdenlive.org/) — видеоредактор, умеющий склеивать
    последовательно снятые фотографии в видеоролик
  - [ffmpeg](https://www.ffmpeg.org/) или его форк
    [libav](https://libav.org/) — тот случай, когда работа с
    изображением из консоли будет вполне оправданна. Наборы
    библиотек и программ для работы с видео, в данном случае — для
    создания видеоролика из нескольких фотографий
  - [slowmoVideo](http://slowmovideo.granjow.net/) — программа,
    замедляющая получившийся видеоролик и делающая его более
    плавным

## Как сделать, чтобы MPlayer использовал rtc, не ставя на него suid бит?

Для тех, у кого в системе есть /etc/sysctl.conf:

    /etc/sysctl.conf:

    dev.rtc.max-user-freq=1024

Для остальных:

    /etc/rc.local:

    echo 1024 > /proc/sys/dev/rtc/max-user-freq

## При просмотре фильмов в MPlayer включается скринсейвер (или монитор «засыпает»), что делать?

    user@linux$ man mplayer

на предмет опции stop-xscreensaver.

Если у вас просто mplayer, без графического интерфейса, берем ваш файл
конфигурации \~/.mplayer/config и пишем в нем строчку

    ~/.mplayer/config:

    stop-xscreensaver = 1

Для gmplayer мы пропишем строчку

    ~/.mplayer/gui.conf:

    stop-xscreensaver = "yes"

Это можно сделать и средствами интерфейса.

Из командной строки можно добавить ключ -stop-xscreensaver

Важно: В руководстве ключ назван неверно -stop_xscreensaver (с
подчеркиванием вместо тире).

## Как увеличить максимальную громкость в MPlayer?

Добавить в \~/.mplayer/config следующие строки:

    softvol=yes
    softvol-max=1000

, где softvol-max -- максимальный уровень звука в процентах
(по-умолчанию 110). Это параметр может принимать значения от
10 до 10000. Также, можно просто при запуске mplayer указать эти опции,
например:

    % mplayer -softvol -softvol-max 1000 yourvideofile.avi

## Сменил видеокарту или обновил MPlayer и больше не регулируется яркость. Что делать?

Прописать в ./mplayer/config вот такую строчку:

    vf = eq2,

Не забудьте запятую.

## Как настроить MPlayer, чтобы с его помощью смотреть ТВ?

Формируется примерно такой файлик:

    #!/bin/bash
    DATE="`date +%H%M%d`"
    PH=/mnt/dos/dvd/tv

    mplayer tv://14 -tv device=/dev/video0:driver=v4l2:width=512:height=384:forcechan=1:normid=2:channels=R7-Culture,R10-Stolica,R6-Sport,R9-TVC,SR2-M1,SR4-TNT,SR3-MTV,SR12-MuzTv,R2-NTV,SR5-STS,R4-RTR,R12-ORT - vo sdl -fs -ao alsa -quiet

## Как смотреть HD контент, BD rip и прочее FullHD?

Использовать, по возможности, новейшую версию mplayer. Для многоядерных
систем не забыть про опцию -lavdopts fast:threads=2 (4 для
четырехядерных) для распараллеливания работы декодера
H.264.

С некоторых пор mplayer поддерживает ускорение средствами видеокарты,
например VDPAU. Вслед за ним поддержка
[VDPAU](ftp://download.nvidia.com/XFree86/vdpau/doxygen/html/index.html),
[VAAPI](http://wiki.videolan.org/VLC_VAAPI) и [Crystal
HD](http://www.broadcom.com/products/features/crystal_hd.php) появилась
в видеоплеере VLC, а также в плеерах, поддерживающих движки ffmpeg,
gstreamer и xine. В mplayer поддерживается только VDPAU, а следовательно
только видеокарты NVIDIA: патчи для поддержки VAAPI не приняты в
mplayer, поэтому создан отдельный mplayer-vaapi. Запускать можно так
(взято из FAQ на rutracker.org):

Для NVIDIA:

` mplayer -vf -clr -vo vdpau -vc ffh264vdpau,ffmpeg12vdpau, video.mkv`

Для AMD/ATi и Intel:

` mplayer-vaapi -vo vaapi:gl -va vaapi video.mkv`

## Как настроить звук в tvtime при использовании DMA вместо Line-in?

В tvtime - никак. Как и в xawtv, zapping, kdetv и тд. Это связано с тем,
что при выводе звука через DMA тв-тюнер представлен в системе отдельной
звуковой картой (посмотреть можно в /proc/asound/cards), а
вышеперечисленный софт не умеет выбирать звуковые
устройства. Для себя я (JB) решил проблему вот таким
"костылем":

    artem@sakura:~$ cat bin/tvtime.sh
    #!/bin/sh
    arecord -D hw:1,0 -r 32000 -c 2 -f S16_LE | aplay - &
    tvtime
    arecord_pid=`ps ax | grep "[0-9] arecord" | cut --bytes=1-5`
    kill $arecord_pid

Первая строчка перенаправляет звук с тв-тюнера на обычную звуковую
карту, вторая запускает tvtime, а третья убивает arecord при
завершении tvtime.

## Как записать тв-программу, используя mencoder?

Для ядра 2.4 и ранних 2.6:

    #!/bin/sh

    DATE="`date +%H%M%d`"

    nice -n 0 mencoder tv:// -tv driver=v4l:width=384:height=288:norm=SECAM: \
    brightness=10:contrast=-20:hue=-70:saturation=-60: \
    audiorate=22050:alsa:forcechan=1:adevice=hw.0: \
    buffersize=32:fps=22 -ovc lavc -lavcopts vcodec=mpeg4: \
    vbitrate=2100:vme=5:vqscale=3:vb_strategy=1: \
    keyint=300 -oac pcm -o "output-"$DATE".avi"

Для ядер 2.6.6 и выше:

    !/bin/sh
    DATE="`date +%H%M%d`"
    PH=/mnt/dos/dvd/tv

    mencoder -tv driver=v4l2:width=512:height=384:device=/dev/video0:\
    norm=SECAM:buffersize=128:fps=24:brightness=10:contrast=-20:hue=-70:\
    saturation=-60:\
    audiorate=22050:alsa:forcechan=1 \
    -oac pcm \
    tv:// \
    -o $PH/$DATE".avi" \
    -ovc lavc -lavcopts \
    vcodec=mpeg4:vbitrate=1200:vme=4:vqscale=3:vb_strategy=1:keyint=300 \
    -vf pp=lb

Первая строчка для Celeron 500, вторая для PIII-966. Подбирайте свои
значения. Название файла формируется, используя время. Кодируем в
MPlayer 1.0pre5. Параметр "on" больше не используется.

Важно что - указать во что кодируем и каким кодеком что для видео, что
для аудио. Аудио лучше пускать в pcm, это написано еще в рассылках
MPlayer, а потом уже пережать такой строчкой:

    #!/bin/sh

    mencoder -ovc copy -oac mp3lame -lameopts aq=0:ratio=100 pcm_file.avi -o your_ready.avi

Если хочется почистить картинку от помех, это можно сделать примерно
так:

    #!/bin/sh

    nice -n 15 mencoder -ovc lavc -lavcopts vcodec=mpeg4:vme=4:vbitrate=1800: \
    keyint=300 -oac copy -vf scale=640:480,pp=hb/vb/dr/al/lb,hqdn3d,lavcdeint,eq=05: \
    10 /mnt/dos/part2.avi -o ready2.avi

Естественно, можно и совместить. Читайте о постпроцессинге.

Есть еще момент - многие жалуются, что несмотря на сильные машины (piv
2600, например) через некоторое время идет framedrop. Лично я (jackill)
боролся с этим, указав число кадров, получаемых с тюнера (опция fps, на
более мощной машине можно поставить больше) и можно жестко задать буфер
(чем больше разрешение, тем больше буфер), чтобы вся память не забилась
(если будет framedrop при динамическом буфере, то сначала кончится
память, затем пойдет framedrop). В рассылке говорили, что звук
лучше забирать в pcm (мол, lame тоже может стать причиной сбоя).

Тем не менее при битрейте в 900 я записывал звук в mp3, получая меньшую
нагрузку на винт и на процессор. Более того, за четыре часа у меня не
было ни одной рассинхронизации звука или видео, а так же не
заканчивалась память (правда у меня 640Мб RAM):

    #!/bin/sh
    DATE="`date +%H%M%d`"
    PH=/mnt/dos/dvd/tv

    mencoder -tv driver=v4l2:width=512:height=384:device=/dev/video0:\
    normid=2:buffersize=128:fps=22:brightness=10:contrast=-20:hue=-70:\
    saturation=-60:\
    audiorate=22050:alsa:forcechan=1 \
    -oac mp3lame -lameopts vbr=0:br=32:aq=9:mode=3 -o mult5.avi \
    tv:// \
    -o $PH/$DATE".avi" \
    -ovc lavc -lavcopts \
    vcodec=mpeg4:vbitrate=900:vme=4:vqscale=3:vb_strategy=1:keyint=300 \
    -vf pp=lb

## Возможно ли писать что нибудь с тюнера и смотреть в это время то что я пишу или другой канал?

Другой канал нельзя - приемник-то один. А смотреть и писать теперь
можно, если воспользоваться программой xdtv (весьма удобная и
быстрая, но иногда валится через пару часов использования, вешая
систему намертво).

[1](http://xawdecode.sourceforge.net/htmlpageUS/indexUS.shtml)

## Сделал все, как написано здесь, но при записи с mencoder картинка с тв-тюнера пишется, а звук - нет. Звуковая система - alsa. Что делать?

Запускаем **alsamixer** и в нем снимаем, если есть, mute с канала Line
(клавиша m), далее ставим capture на каналы Line и Capture (клавиша
пробел).

## Что делать, если в alsamixer у меня нет больше регуляторов Line и Capture, а звук надо записывать?

Воспользоваться утилитой amixer. Регулятор Line называется line.
Регулятор Capture называется cap.

## Как посылать именно фильм на телевизор, а все остальное - на монитор?

При настроенном X-сервере - легко:

    user@linux# alias mplayertv='export DISPLAY=:0.1 & qut;" mplayer -fs'

О настройках карточек nvidia через TwinView читайте в документации
nvidia, если нужны более хитрые настройки, читайте здесь. О настройке
карт ATI читайте здесь.

## Как на Nvidia настроить TV-Out так, чтобы фильм из mplayer выводился на TV, а монитор оставался свободным? Как сделать так, чтобы разрешения менялись независимо?

A: Например, так. Приведены только интересующие нас разделы
/etc/X11/xorg.conf (ранее /etc/X11/XF86Config)

    Section "ServerLayout"
            Identifier "Default Layout"
            Screen 0 "Monitor" 0 0
            Screen 1 "TVout" RightOf "Monitor"
            InputDevice "Mouse1" "CorePointer"
            InputDevice "Keyboard1" "CoreKeyboard"
    EndSection

    Section "Monitor"
            Identifier "CRTmonitor"
            ModelName "LG 795FT"
            HorizSync 30.0 - 96.0
            VertRefresh 50.0 - 160.0
    EndSection

    Section "Monitor"
            Identifier "HomeTV"
            ModelName "TVset"
            HorizSync 30.0 - 50.0
            VertRefresh 50.0 - 60.0
    EndSection

    Section "Device"
            Identifier "NVGF4-1"
            Driver "nvidia"
            BoardName "Ti4800-VDT8X (MS-8900)"
            VideoRam 131072
            Option "NvAGP" "3"
            Option "NoLogo" "1"
            Option "RenderAccel" "1"
            Option "TwinView" "1"
            Option "DPMS" ""
            BusID "PCI:1:0:0"
    EndSection

    Section "Device"
            Identifer "NVGF4-2"
            Driver "nvidia"
            BoardName "Ti4800-VDT8X (MS-8900)"
            VideoRam 131072
            Option "NvAGP" "3"
            Option "NoLogo" "1"
            Option "RenderAccel" "1"
            Option "TVOutFormat" "COMPOSITE"
            Option "ConnectedMonitor" "TV"
            Option "TVStandard" "NTSC-M"
            BusID "PCI:1:0:0"
            Screen 1
    EndSection

    Section "Screen"
            Identifier "Monitor"
            Device "NVGF4-1"
            Monitor "CRTmonitor"
            DefaultDepth 16

            SubSection "Display"
                    Depth 8
                    Modes "1600x1200" "1280x1024" "1280x960" "1152x864" "1024x768" "800x600" "640x480"
            EndSubSection

            SubSection "Display"
                    Depth 16
                    Modes "1600x1200" "1400x1050" "1280x1024" "1280x960" "1152x864" "1024x768" "800x600" "640x480"
            EndSubSection

            SubSection "Display"
                    Depth 24
                    Modes "1600x1200" "1280x1024" "1280x960" "1152x864" "1024x768" "800x600" "640x480"
            EndSubSection
    EndSection

    Section "Screen"
            Identifier "TVout"
            Device "NVGF4-2"
            Monitor "HomeTV"
            DefaultDepth 16

            SubSection "Display"
                    Depth 8
                    Modes "800x600" "640x480"
            EndSubSection

            SubSection "Display"
                    Depth 16
                    Modes "800x600" "640x480"
            EndSubSection

            SubSection "Display"
                    Depth 24
                    Modes "800x600" "640x480"
            EndSubSection
    EndSection

    Еще вариант, без TwinView.

    #monitor

    Section "Device"
            Identifier      "nvidia0"
                    Driver          "nvidia"
                    BusID           "PCI:1:0:0"
                    Option          "NvAGP"                 "1"
                    Option          "NoLogo"                "true"
                    Option          "RenderAccel"           "true"
                    Option          "CursorShadow"          "true"
                    Option          "IgnoreEDID"            "true"
                    Option          "IgnoreDisplayDevices"  "DFP"
                    Option          "ConnectedMonitor"      "CRT"
                    Screen 0
    EndSection

    #TV
    Section "Device"
            Identifier      "nvidia1"
            Driver          "nvidia"
            BusID           "PCI:1:0:0"
            Option          "NvAGP"                 "1"
            Option          "NoLogo"                "true"
            Option          "RenderAccel"           "true"
            Option          "CursorShadow"          "true"
            Option          "IgnoreEDID"            "true"
            Option          "IgnoreDisplayDevices"  "DFP"
            Option          "ConnectedMonitor"      "TV"
            Option          "TVStandard"            "PAL-B"
            Option          "TVOutFormat"            "COMPOSITE"
            Screen 1
    EndSection

    #Monitor description
    Section "Monitor"
            Identifier      "monitor"
            HorizSync       30-96
            VertRefresh     50-160
            Option          "DPMS"
    EndSection

    #TV description
    Section "Monitor"
            Identifier      "tv"
            HorizSync       30-50
            VertRefresh     60
    EndSection

    Section "ServerLayout"
            Identifier      "Default Layout"
            Screen          "screen0"
            InputDevice     "Generic Keyboard"
            InputDevice     "Configured Mouse"
    EndSection

    Section "ServerLayout"
            Identifier      "crt-tv"
            Screen          "screen0"
            Screen          "screen1" RightOf "screen0"
            InputDevice     "Generic Keyboard"
            InputDevice     "Configured Mouse"
    EndSection

Не забудьте прописать разрешения на оба устройства.

Когда нужен телевизор:

    user@localhost$ startx -- -layout ctr-tv

Команда вывода кино на телевизор:

    user@localhost$ DISPLAY=:0.1 mplayer -fs файл

## Почему при попытке просмотра фильма в MPlayer в полноэкранном режиме фон только меняется на черный, а размер картинки остается прежним?

DiMoN отвечает:

Список того, какой вывод поддерживается:

    user@linux# mplayer film.avi -vo help

Лучшие варианты:

    user@linux# mplayer film.avi -vo xv -fs
    user@linux# mplayer film.avi -vo xvidix -fs

Когда-то через SDL добился нормального воспроизведения на
Celeron333/64Mb/S3Trio64V+:

    user@linux# mplayer film.avi -vo sdl -fs

C остальными могут быть проблемы по скорости воспроизведения:

    user@linux# mplayer film.avi -vo gl2 -fs
    user@linux# mplayer film.avi -vo gl -fs
    user@linux# mplayer film.avi -vo dga -fs

Консольные варианты:

    user@linux# mplayer film.avi -vo vesa -fs
    user@linux# mplayer film.avi -vo svga -fs
    user@linux# mplayer film.avi -vo vidix -fs
    user@linux# mplayer film.avi -vo cvidix -fs

Текстовыми символами:

    user@linux# mplayer film.avi -vo aa -fs

На худой конец так (тормоза + потеря кадров):

    user@linux# mplayer film.avi -vo x11 -fs -zoom -framedrop -hardframedrop

## MPlayer - проблемы с интерфейсом: любой "скин" он показывает черным, элементов управления тоже не видно. Что делать?

Это проявляется на определенных картах. Попробуйте поменять битность
цвета. Должно сработать.

## Как в MPlayer просмотреть VCD?

1\. Не надо монтировать диск.

2\. mplayer -vcd://номер_трека \[остальные ключи\].

## Как в сграбить audio-CD в mp3 (в том числе из консоли)?

Можно воспользоваться либо грабберами или программами для записи
компакт-дисков с поддержкой таких функций.

    user@linux:~$ mpg123 --cdr file.cdr file.mp3
    user@linux:~$ cdrecord -v speed=4 dev=0,0,0 -pad -audio *.cdr

Для группы файлов:

    user@linux:~$ find . -name "*.mp3" -exec mpg123 --cdr {}.cdr {} \;

Если полученный wav файл не в формате "16 bit, stereo, 44100 Hz"
(проверить можно: "file file.wav", обычно mpg123 осуществляет
преобразование автоматически):

    user@linux:~$ mpg123 -w file.wav file.mp3
    user@linux:~$ sox file.wav -r 44100 file_new.wav

Для нормализации громкости удобно использовать:

    normalize -m *.wav

Можно воспользоваться этим скриптом (автор мне, увы, неизвестен):

    #!/bin/bash
    rm -v track*.wav
    disc-cover -e -o tracks -t txt &&
    mv tracks.txt tracks.cddb &&
    disc-cover -o cover -t ps &&
    ARTIST=`cat tracks.cddb | grep -E '^Artist\:'| gawk -F\: '{print $2}' | sed -e's/^ *//' -e's/ *$//'`
    ALBUM=`cat tracks.cddb | grep -E '^Title\:'| gawk -F\: '{print $2}' | sed -e's/^ *//' -e's/ *$//'`
    echo "$ARTIST/$ALBUM"
    #echo $ALBUM
    mkdir -p "$ARTIST/$ALBUM"

    cdparanoia -sQ 2>&1 | tee toc &&
    cdparanoia -w -z5 -B 2>&1 | tee cdparanoia.log || exit
    #grep -E '^( )+([0-9])+\.' toc | gawk -F. '{print $1}'
    for i in track*.cdda.wav; do
    num=`echo $i | sed -e's/^track\([0-9]*\)\.cdda\.wav/\1/'`
    #echo -n $num " - "
    num1=`echo $num | sed -e's/^0//'`
    #echo $num1
    title=`grep -E "^([0])*$num1\ " tracks.cddb | \
            gawk 'BEGIN {ORS=" "} {for(n=2;n<NF-1;n++) print $n;}' | sed -e's/^ *//' -e's/ *$//'`
            #echo $title
            nice oggenc -b 192 -N $num -a "$ARTIST" -l "$ALBUM" -t "$title" -n "$ARTIST/$ALBUM/$num - %t.ogg" $i || exit
            #mv -v $i $ii
            done;

## Как записать audio-CD из mp3 (wav)?

Пользователи KDE скорее всего записывают диски программой k3b, поэтому
могут воспользоваться ею. Очень удобно.

Многие пользуются программой xcdroast. Поскольку интерфейс слегка
запутан, пара слов о процессе. В каталог для cd-образов
копируются wav, сделанные из mp3. Далее делаем "Создать диск"
-\> "Записать дорожки". В закладке "Раскладка дорожек в правом окне
выделяем все wav-файлы и нажимаем кнопку "Добавить". Переходим в
закладку "Записать дорожки" и нажимаем на кнопку "Записать дорожки".

Примечание: в старой локализации xcdroast дорожки называются треками.

Также, можно чудесно записать все из консоли

    user@linux:~$ cdrecord -audio -pad -dev=0,0,0 1.wav 2.wav 3.wav

Подробнее смотрите **man cdrecord**.

## Чем под Linux сделать DVD-диск из avi-файла? Как сделать DVD с помощью mencoder, или transcode?

Можно попробовать графические утилиты (они вам пригодятся для создания
менюшек и т.п.) под названием
[QDVDAuthor](http://kde-apps.org/content/show.php?content=14129) или
[DeVeDe](http://www.rastersoft.com/programas/devede.html).

Можно прочитать вот [эту
статью](http://gentoo-wiki.com/HOWTO_Create_a_DVD#Using_mencoder_.28alternative_to_transcode.29)
или же сделать все скриптами как показано ниже.

Алгоритм кодирования в dvd такой:

1\. Звук конвертируете в pcm, ac3, mp2 (mpeg 1 layer2). 2. Видео
конвертируете в mpeg2video. Это можно сделать с помощью mplex из
комплекта mjpegtools, или с помощью mencoder (output format: -of mpeg),
но лучше первым. К тому же mencoder не умеет делать звук mp2. 3. Далее
можно пропустить это через dvdauthor, чтобы сформировать структуру
каталогов. 4. Затем делается image. 5. Запись.

Все прочитали? Можно автоматизировать процесс с помощью mkdvd. Или
скрипта Obidos'а:

1-й случай. PAL (в исходном avi 25fps).

```




#!/bin/sh

mkdir tmp
ORIG=tmp/`basename $1 .avi`
echo "Doing transcode..."
transcode -i $1 -V -y mpeg2enc,mp2enc -F "5,-S 800" -E 44100 -b 128  -o $ORIG -Z 480x576
echo "Doing mplex..."
mplex -f 4 -S 800 -o $ORIG%d.mpg $ORIG.m2v $ORIG.mpa
```

2-й случай. NTSC (в исходном avi 29.97fps либо 23.976fps).

    #!/bin/sh

    mkdir tmp
    ORIG=tmp/`basename $1 .avi`
    echo "Doing transcode..."
    transcode -i $1 -V -y mpeg2enc,mp2enc -F "5,-S 800" -E 44100 -b 128  -o $ORIG -j -92 -Z 480x480
    echo "Doing mplex..."
    mplex -f 4 -S 800 -o $ORIG%d.mpg $ORIG.m2v $ORIG.mpa
    #end

3\. Скрипт сборки образа диска для прожига

    #!/bin/sh

    TITLE=`basename $1 .mpg`
    echo "Doing VCDImager..."
    vcdimager -p -t svcd -b $TITLE.bin -c $TITLE.cue $@

4\. Скрипт прожига

    #!/bin/sh
    # первый параметр -- имя .cue-файла, второй -- скорость.

    cdrdao write -v 2 --speed $2 $1

Замечания.

1\. Для NTSC материала нужно правильно подобрать значение параметра -j.
Указанное значение (-92) корректно для фильмов им. тов. Гоблина (тех,
что я кодировал).

2\. Максимальный размер диска -- 800Мб, что отлично влезает на 700Мб
болванку из-за того, что пишется "полный" сектор. Грубо можно
считать "800Мб == 80 мин".

Где взять: mkdvd [2](http://fredrik.hubbe.net/hacks/) mjpegtools
[3](http://mjpeg.sourceforge.net/) dvdauthor
[4](http://dvdauthor.sourceforge.net) mencoder
[5](http://www.mplayerhq.hu) transcode
[6](http://www.transcoding.org/cgi-bin/transcode)

Дополнительное инфо по сборке DVD и редактированию видео с помощью kino:
[7](http://www.linuxmafia.com/faq/Apps/AV/consumer-video-to-dvd.html)

Дополнительное инфо по правам файловой структуры на получаемом DVD:
[8](http://dvd.chevelless230.com/)

Дополнительное инфо о том, как писать:
[9](http://www.freesoftware.fsf.org/dvdrtools/)

## Как пережать DVD9 в DVD5?

Взято [отсюда](http://www.opennet.ru/base/sys/dvd_r_mix.txt.html). Автор
Vladimir Kurtukov. Переписано в FAQ, дабы не потерялось.

Hеобходимые программы: 1. dvdauthor, dvdunauthor -
[10](http://dvdauthor.sourceforge.net/)

2\. mplex mjpegtools не ниже 1.6.2 - [11](http://mjpeg.sourceforge.net/)

3\. extract_mpeg2 libmpeg2 - [12](http://libmpeg2.sourceforge.net/)

4\. extract_a52 liba52 - [13](http://liba52.sourceforge.net/)

5\. tcprobe - [14](http://www.transcoding.org/cgi-bin/transcode)

6\. M2VRequantizer - [15](http://metakine.com/files/M2VRequantiser.tgz)

7\. growisofs, mkisofs

Сам процесс:

1\. **dvdunauthor**-ом делаем с dvd проект. он его делает не совсем
правильно и надо либо выкинуть vmgm и menus секции, либо как-то
дописать недостающее. для компьютерных dvd можно выкинуть.

2\. Надо посмотреть, что собой представляет vob.

```
        # tcprobe -i vob_01_001t.vob
        [tcprobe] MPEG program stream (PS)
        [tcprobe] summary for vob_01_001t.vob, (*) = not default, 0 = not detected
        import frame size: -g 720x576 [720x576]
             aspect ratio: 16:9 (*)
               frame rate: -f 25.000 [25.000] frc=3
                           PTS=0.2873, frame_time=40 ms, bitrate=9800 kbps
              audio track: -a 1 [0] -e 48000,16,2 [48000,16,2] -n 0x2000 [0x2000]
                           PTS=0.2873, bitrate=384 kbps
        detected (2) subtitle(s)
```

3\. затем большой vob расчленяем на video и audio потоки

```
        extract_mpeg2 <vob_01_001t.vob >vob_01_001t.m2v
        extract_a52 -s 1 <vob_01_001t.vob >vob_01_001t.ac3
```

В ключик -s подставить номер нужной дорожки, см. -a в выводе **tcprobe**

Проверить, какая же именно дорожка нам нужна, можно задав **mplayer**-у
ключик -aid 128+<номер нужной дорожки>

4\. Берем софтину **M2VRequantizer**.

    user@localhost~ $ ls -l vob_01_001t.m2v

            -rw-r--r--  1 root  wheel  1833868872 Mar  5 22:58 vob_01_001t.m2v

            # ./M2VReqiantizer 1.2 3 1833868872 <vob_01_001t.m2v >vob_01_001t-out.m2v
            M2VRequantiser by Makira.
            Using 1.200000 as factor, 1833868872 as m2v size.

**factor** - число, во сколько раз будет уменьшен размер файла

    user@localhost~ $ ls -l vob_01_001t-out.m2v
            -rw-r--r--  1 root  wheel  1525283645 Mar  5 23:36 vob_01_001t-out.m2v

5\. Собираем обратно vob.

    user@localhost~ $ mplex -f 8 -o vob_01_001t.vob vob_01_001t-out.m2v vob_01_001t.ac3

где **-f 8** - формат DVD

6\. Остается запустить dvdauthor.

```
        # dvdauthor -o dvd -x dvdauthor.xml
        # dvdauthor -T -o dvd
```

и в каталоге dvd будет результат

7\. Запись на болванку.

    user@localhost~ $ growisofs -Z /dev/cd0c -speed=4 -dvd-video -V LABEL dvd

## Как перекодировать DVD в mpeg4 (dvd2mpeg)?

Пришлось отдельно выносить этот вопрос, потому что предыдущий
вопрос-ответ никто не читает.

Перекодировать ваш DVD в mpeg4 можно с помощью консольных утилит
[mencoder](http://mplayerhq.hu/) и
[transcode](http://www.transcoding.org/cgi-bin/transcode).

Посчитать битрейт можно с помощью калькулятора
[DivXcalc](http://kde-apps.org/content/show.php?content=14204).

Кодирование в 2 прохода с двумя звуковыми дорожками на два cd можно
сделать таким скриптом (в mpeg4):

    #!/bin/bash

    PH=/mnt/dos/dvd
    READYPH=/mnt/dos/dvd/ready
    BITRATE=1600
    NICE=15
    ENG=129
    RUS=128
    FPS=25
    DATE="`date +%H%M%d`"

    cp divx2pass.log "divx2pass-"$DATE".log"

    cat $PH/*vob | nice -n $NICE mencoder - -ofps $FPS -ni -aid $RUS \
    -ovc frameno \
    -oac mp3lame -lameopts vbr=3:br=192:q=0:aq=0 \
    -o $READYPH/"sound-"$RUS".avi"

    cat $PH/*.vob | nice -n $NICE mencoder - -ofps $FPS -ni -aid $ENG \
    -ovc frameno \
    -oac mp3lame -lameopts vbr=3:br=192:q=0:aq=0 \
    -o $READYPH/"sound-"$ENG".avi"

    cat $PH/*.vob | nice -n $NICE mencoder - -ofps $FPS \
    -ovc lavc -lavcopts vcodec=mpeg4:vpass=1:vhq:vbitrate=$BITRATE:vme=5:keyint=300:v4mv:mv0:qpel:trell:cbp:naq \
    -vf scale=640:360,pp=hb/vb/dr -sws 2 \
    -nosound \
    -o /dev/null

    cat $PH/*.vob | nice -n $NICE mencoder - -ofps $FPS \
    -ovc lavc -lavcopts vcodec=mpeg4:vpass=2:vhq:vbitrate=$BITRATE:vme=5:keyint=300:v4mv:mv0:qpel:trell:cbp:naq \
    -vf scale=640:360,pp=hb/vb/dr -sws 2 \
    -nosound \
    -o $READYPH/final-f1.avi

    rm -f $PH/*.vob

    nice -n $NICE avimerge -i $READYPH/final-rc1.avi -p $READYPH/"sound-"$RUS".avi" -o $READYPH/final-rc2.avi
    nice -n $NICE avimerge -i $READYPH/final-rc2.avi -p $READYPH/"sound-"$ENG".avi" -o $READYPH/final.avi

Для кодирования в три прохода понадобится mplayer версии не ниже 1.0pre7
и кодек lavc.

Или в этом скрипте можно поменять несколько строчек и кодировать в xvid:

меняем строчку с cp:

    cp xvid-twopass.stats "xvid-twopass-"$DATE".stats"

и меняем строчки с кодированием видео

    cat $PH/*.vob | nice -n $NICE mencoder - -ofps $FPS -ni \
    -ovc xvid -xvidencopts pass=1:vhq=1:qpel:trellis \
    -nosound \
    -vf crop=718:422:2:66,scale=640:356,pp=hb/vb/dr -sws 2 \
    -o /dev/null

    cat $PH/*.vob | nice -n $NICE mencoder - -ofps $FPS -aid $RUS -ni \
    -ovc xvid -xvidencopts bitrate=$BITRATE:pass=2:vhq=1:qpel:trellis \
    -nosound \
    -vf crop=718:422:2:66,scale=640:356,pp=hb/vb/dr -sws 2 \
    -o $READYPH/final-rc1.avi

Если вы хотите оставить звук в ac3 (как он идет в dvd), то вместо
строчек перекодирования в mp3 поставьте

    -oac copy

## Как перекодировать фильм для КПК (PDA,avi,DVD)?

Точно так же, как и для обычного компьютера. Разница заключается в
разрешении и битрейте. Так же не стоит пользоваться экзотическими
кодеками.

Фильмы, закодированные так, как описано, прекрасно смотрятся с помощью
tcpmp (преемник betaplayer).

Будь то КПК с разрешением VGA или QVGA для обоих прекрасно подойдет
классическое разрешение 320x240 и его вариации. Битрейт - от 170 до
220 кбит/сек. Поставите меньше - получите квадраты на быстрых сценах.
Поставите больше и увеличите размер файла без заметного улучшения
качества.

Не советую ухудшать звук, если пережимаете из avi-файла, потому что если
экран у вас меньше, то звук-то как раз не ухудшается. Более того, в
наушниках некачественный звук раздражает больше. Хотя, если места
совсем мало, можете сделать звук mono, 22050 Гц на 80кбит/с. Это
минимум того, что я видел. Экономит примерно 30-40Мб.

Итак, скрипт для перекодировки фильма из avi-файла с помощью mencoder
(кодируется реальный полуторачасовой фильм "К оружию" из серии
"Вавилон-5"):

    #!/bin/bash

    PH=/mnt/dos/media/Video
    READYPH=/mnt/dos/media/Video/ready
    NAME=Babylon5_Call_to_Arms
    BITRATE=230
    NICE=15
    ENG=129
    RUS=128

    nice -n $NICE mencoder /mnt/dos/media/Video/$NAME".avi" -ni \
    -ovc lavc -lavcopts vcodec=mpeg4:vhq:vbitrate=$BITRATE:vme=5:keyint=300:v4mv:mv0:qpel:trell:cbp:naq \
    -vf scale=320:176,pp=hb/vb/dr -sws 2 \
    -oac copy \
    -o $READYPH/$NAME"-pda.avi"

Несколько проходов не нужно, потому как улучшения качества не
наблюдается.

Можно еще число кадров снизить. Тогда добавим в строчку команду **-ofps
25** для того, чтобы получить 25 кадров в секунду. Правда есть засада -
на некоторых сценах изображение может дергаться.

Размер фильма будет около 200 Мб. Так что на гигабайтную карту легко
поместятся четыре фильма.

Точно так же кодируется фильм из DVD. Меняем строчку с параметрами на
нижеприведенные:

    cat $PH/*vob | nice -n $NICE mencoder - -ni -aid $RUS \
    -ovc frameno \
    -oac mp3lame -lameopts vbr=3:br=192:q=0:aq=0 \
    -o $READYPH/"sound-"$RUS".avi"

    cat $PH/*.vob | nice -n $NICE mencoder - \
    -ovc lavc -lavcopts vcodec=mpeg4:vhq:vbitrate=$BITRATE:vme=5:keyint=300:v4mv:mv0:qpel:trell:cbp:naq \
    -vf scale=320:176,pp=hb/vb/dr -sws 2 \
    -nosound \
    -o $READYPH/fin_noso.avi

    nice -n $NICE avimerge -i $READYPH/fin_noso.avi -p $READYPH/"sound-"$RUS".avi" -o $READYPH/final.a
    vi

## Как работать с MiniDV видеокамерой?

Для начала нужно включить аппаратную поддержку.

Потом надо установить libiec61883, libraw1394 с сайта
[16](http://www.linux1394.org), а также CLI утилиту dvgrab, с помощью
которой можно будет копировать raw dv видео с камеры.

Для работы с MiniDV камерой и несложного редактирования видео существует
программа Kino, в состав которой входит набор плагинов и скриптов,
например: dv-\>mpeg4, dv-\>dvd и т.д.

## Как изображение с DV-пленки перенести на DVD?

Статья о том, как это делается в Alt Linux. Подойдет и для использования
в других дистрибутивах.

[17](http://rad.xtalk.msk.su/dv-dvd/index.html)

## В mplayer при быстрой смене кадров вылазят горизонтальные полосы. В xine их нет. Что делать?

Использовать параметр **-double** или прописать его в свой файл
конфигурации **double = 1**

## Как проиграть AMR на Linux?(3gp)

Поставить библиотеку amrnb, пересобрать MPlayer с ней. VLC вроде как
должен играть из коробки.

## Как воспроизвести APE+CUE (FLAC+CUE, etc) в Linux

Например, можно "порезать" .ape+.cue (.flac+.cue) на .flac-дорожки (FLAC
играется любым плейером). Не вдаваясь в подробности предлагаю такой
вариант:

    $ sudo aptitude install cuetools shntool flac wavpack
    $ ffmpeg -i CDImage.ape CDImage.flac
    $ cuebreakpoints CDImage.cue | shnsplit -a "Miles Gurtu" -o flac CDImage.flac
    $ cuetag CDImage.cue Miles*.flac

Кроме того можно преобразовать во flac и записать embedded cue и открыть
в mpd:

    $ shntool conv file.ape  -o flac
    $ metaflac --set-tag-from-file="CUESHEET=file.cue" --import-cuesheet-from=file.cue file.flac

после чего рекомендуется обновить базу mpd. Последние версии mpd
наитивно прочитают этот флак как директорию с треками.

возможно, shntool умеет сам добавлять cuesheet. но в моём случае между
первой и второй командой прошло много месяцев.

А такие плееры, как deadbeef, qmmp и xmms2(рассматривает cue как
плейлист) умеют играть cue нативно.

[Category:Мультимедиа](Category:Мультимедиа) [Category:L.O.R.
FAQ](Category:L.O.R._FAQ)