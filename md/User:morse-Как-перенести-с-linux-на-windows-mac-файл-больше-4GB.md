В данной статье будут рассмотрены возможности передачи файлов с помощью
внешних накопителей. Про передачу по сети смотрите статьи samba, nfs,
ftp.

# А в чем, собственно, проблема?

Проблема заключается в том, что операционные системы Windows
поддерживают только две файловые системы — NTFS и FAT. Из
них первая — проприетарная и закрытая, а вторая имеет жесткое
ограничение на размер файла в 4ГБ. В случае с MAC OS к этим двум
добавляется файловая система HFS/+, тоже проприетарная и, хотя и не
закрытая, до сих пор не имеющая нормальной реализации под линуксом.
Существуют свободные реализации NTFS под linux — это linux-NTFS
(содержится в ядре) и ntfs-3g. Обе реализации позволяют
производить чтение с NTFS-разделов, но не гарантируют
целостности данных при записи. Вероятность повреждения данных
резко возрастает, когда речь идет о файлах больших размеров, поэтому
использовать NTFS для передачи больших файлов можно только если вы
совсем не дорожите тем, что на диске. Если не рассматривать варианты
установки windows на виртуальную машину или использования платных
ntfs-драйверов под линукс, проблема кажется неразрешимой.

# Пути решения

Путей, собственно, только два: это разрезание исходных файлов с
последующим сшиванием в месте назначения, или использование
файловой системы UDF.

## Разрезание файла

Преимущество этого метода в том, что можно использовать любой внешний
носитель отформатированный под fat32 (то есть практически каждый).
Недостаток заключается в том, что нарезанный файл нельзя сразу
использовать, а надо скопировать на жесткий диск и так или иначе
привести в исходный вид.

### 7z

Можно воспользоваться архивом 7z, т.к. он свободен, имеет реализации под
все платформы и поддерживает тома.

**Достоинства**

  - Очень легко сделать. В большинстве DE опция "создать архив" доступна
    прямо из контекстного меню

**Недостатки**

  - Время распаковки/запаковки. Для файла в несколько десятков гигабайт
    может исчисляться часами, при том что размер скорее всего не
    изменится. Хотя можно заюзать утилиту командной строки 7z с
    ключом -mx=0, чтобы отключить сжатие.
  - 7z не поддерживается в Win/Mac "из коробки", требуется установка
    дополнительного софта

### split

Утилита split из пакета coreutils предназначена как раз для разрезания
файлов на куски. Синтаксис прост:

`split –b 1GB `<имя_файла>` `<префикс>

В результате получатся файлы с именами <префикс>aa <префикс>ab
<префикс>ac итд (кстати, размер будет не "нормальный" 1ГБ,
который 1024\*1024\*1024 байт, а "рекламный" 1ГБ, который
миллиард байт). Чтобы сшить файлы обратно можно воспользоваться
командой

`cat `<префикс>`* > `<имя_файла>

в windows

`copy /b `<префикс>`aa+`<префикс>`ab+`<префикс>`ac[+...] `<имя_файла>

**Достоинства**

  - Быстро. Времени займет столько же, сколько и простое копирование
    файла на внешний диск
  - Не надо устанавливать дополнительный софт, используются только
    стандартные программы linux/mac/win

**Недостатки**

  - Требуется вручную вбивать команды в консоль/терминал, что означает
    что передать таким образом файл можно будет только человеку с
    минимум средней компьютерной грамотностью

## Файловая система UDF

Хотя выше было написано, что windows/mac поддерживают только FAT, NTFS и
HFS, это не совсем верно. Также почти все операционные системы
поддерживают файловые системы ISO 9660 (также известную как
CDFS) и UDF. Первая используется на CD, а вторая на DVD. Несмотря на то,
что UDF создавалась с прицелом на dvd-диски, ее можно использовать и для
других носителей. Для создания файловой системы потребуется пакет
udftools. Создать файловую систему можно в отдельном разделе, а можно
прямиком на устройстве. В первом случае надо предварительно создать
на устройстве раздел (с помощью fdisk или \[g\]parted), а во втором,
убедиться что таблица разделов пуста. Создание файловой системы
производится следующей командой:

`mkudffs --media-type=hd --blocksize=512 /dev/sdX[Y]`

Такая флешка не будет иметь ограничений на максимальный размер файла
(если не рассматривать 16\*10<sup>18</sup> байт как ограничение), и в
любом случае будет видна в linux. С другими операционными системами
ситуация сложнее. MacOS будет видеть флешку только если ФС была
создана прямиком на устройстве, без таблицы разделов, в то время как
windows требует наличия таблицы разделов. windows XP гарантированно
будет видеть ее как read-only, в то время как более поздние версии
должны иметь возможность на запись. Будут ли — вопрос открытый. В
зависимости от неизвестных науке факторов, флешка может опознаться
и как доступная только на чтение, и как на чтение-запись. А может и не
опознаться вообще. В этом случае можно поставить id раздела не 83
(linux), который mkudffs ставит по умолчанию, а 06 (FAT16). Это повышает
вероятность того, что флешка определится под windows корректно.

**Достоинства**

  - Флешка будет работать везде как обычно. Единожды созданная, она
    больше не потребует никаких дополнительных действий для
    переноса файлов

**Недостатки**

  - Под windows она возможно будет доступна только в режиме read-only.
    Может рассматриваться в качестве достоинства.
